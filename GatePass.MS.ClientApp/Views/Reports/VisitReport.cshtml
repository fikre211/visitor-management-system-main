@using GatePass.MS.Domain.ViewModels;
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
@model VisitReportModel
@{
    ViewData["Title"] = "Visit Report";

    // Prepare options for status dropdown
    var statusOptions = new[] { "Pending", "Approved", "Rejected" };

    // Prepare options for employee dropdown
    var employees = Model.Employees.Select(e => new { e.Id, e.FirstName }).ToList();
}

<div class="container-worap">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-info">
                    <form method="get" action="@Url.Action("VisitReport", "Reports")" class="row g-3 align-items-center">
                        
                        <div class="col-md-2 form-group">
                            <label for="startDate" class="form-label">@Localizer["Start Date"]:</label>
                            <input type="date" id="startDate" name="startDate" class="form-control" value="@Model.StartDate?.ToString("yyyy-MM-dd")" />
                        </div>
                        <div class="col-md-2 form-group">
                            <label for="endDate" class="form-label">@Localizer["End Date"]:</label>
                            <input type="date" id="endDate" name="endDate" class="form-control" value="@Model.EndDate?.ToString("yyyy-MM-dd")" />
                        </div>
                        <div class="col-md-2 form-group">
                            <label for="status" class="form-label">@Localizer["Status"]:  </label><br />
                            <select id="status" name="status" class="form-control">
                                <option value="">@Localizer["All"]</option>
                                @foreach (var status in statusOptions)
                                {
                                    <option value="@status">@status</option>
                                }
                            </select>
                        </div>
                        <div class="col-md-2 form-group">
                            <label for="employee" class="form-label">@Localizer["Employee"]:</label>
                            <select id="employee" name="employeeId" class="form-control">
                                <option value="">@Localizer["All"]</option>
                                @foreach (var employee in employees)
                                {
                                    <option value="@employee.Id">@employee.FirstName</option>
                                }
                            </select>
                        </div>
                        <div class="col">
                            <button type="submit" class="btn btn-success float-right"> <i class="fas fa-filter"></i> @Localizer["Filter"]</button>
                        </div>
                    </form>

                </div>
                <!-- /.card-header -->

                <div class="card-body table-responsive p-0" style="height: 420px;">
                    <table id="myDataTable" class="table table-bordered table-striped table-head-fixed">
                        <thead>
                            <tr>
                                <th>@Localizer["Request ID"]</th>
                                <th>@Localizer["Visitor Name"]</th>
                                <th>@Localizer["Visitor Phone"]</th>
                                <th>@Localizer["Visitor Email"]</th>

                                <th>@Localizer["Additional Guests"]</th>
                                <th>@Localizer["Devices"]</th>

                                <th>@Localizer["Approved Time Start"]</th>
                                <th>@Localizer["Approved Time End"]</th>
                                <th>@Localizer["Purpose"]</th>
                                <th>@Localizer["Inviter"]</th>
                                <th>@Localizer["Request Date"]</th>
                                <th>@Localizer["Approved or Rejected By"]</th>
                                <th>@Localizer["Status"]</th>
                            </tr>
                        </thead>

                        <tbody>
                            @foreach (var report in Model.Reports)
                            {
                                <tr>
                                    <td>@report.RequestId</td>
                                    <td>@report.GuestName</td>
                                    <td>@report.Phone</td>
                                    <td>@report.Email</td>

                                    <!-- NEW FIELDS -->
                                    <td style="width: 120px;">@report.AdditionalGuests</td>
                                    <td style="width: 120px;">@report.Devices</td>

                                    <td>@report.ApprovedDateTimeStart</td>
                                    <td>@report.ApprovedDateTimeEnd</td>
                                    <td>@report.PurposeOfVisit</td>
                                    <td>@report.EmployeeName</td>
                                    <td>@report.Timestamp</td>
                                    <td>@report.Approver</td>
                                    <td>@report.Status</td>
                                </tr>
                            }
                        </tbody>
                    </table>

                </div>
                <!-- /.card-body -->
            </div>
            <!-- /.card -->
        </div>
    </div>
</div>
<!-- /.row -->
@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Set the selected value for the status dropdown
            var statusDropdown = document.getElementById('status');
            var selectedStatus = '@Model.Status';
            if (selectedStatus) {
                statusDropdown.value = selectedStatus;
            }

            // Set the selected value for the employee dropdown
            var employeeDropdown = document.getElementById('employee');
            var selectedEmployeeId = '@Model.EmployeeId';
            if (selectedEmployeeId) {
                employeeDropdown.value = selectedEmployeeId;
            }
        });
    </script>
}
