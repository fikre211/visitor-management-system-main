@using GatePass.MS.Domain;
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
@using Microsoft.AspNetCore.Identity

@model List<RequestInformation>
@inject UserManager<ApplicationUser> UserManager

@{
    ViewData["Title"] = "Index";
    var user = await UserManager.GetUserAsync(User);

    var companyName = ViewContext.RouteData.Values["companyName"]?.ToString();
    var isInAdminRole = await UserManager.IsInRoleAsync(user, "ADMIN");
}

<style>
    body {
        padding: 30px !important;
        font-family: 'Segoe UI', sans-serif;
    }

    .card {
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        border: 1px solid #e5e7eb;
    }

    .card-header {
        background: #e8f0ff;
        border-bottom: 1px solid #d0d9ff;
        padding: 12px 18px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .btn-primary {
        background: #1e4db7;
        border-color: #1e4db7;
        padding: 4px 10px;
        font-size: 16px;
        border-radius: 6px;
    }

        .btn-primary:hover {
            background: #163f96;
            border-color: #163f96;
        }

    .table {
        border-collapse: separate;
        border-spacing: 0 6px;
    }

        .table thead th {
            background: #1e4db7;
            color: white;
            border: none;
            font-size: 16px;
            padding: 10px;
        }

        .table tbody tr {
            background: #ffffff;
            border-radius: 6px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
        }

        .table td {
            vertical-align: middle;
            font-size: 16px;
            padding: 12px 10px;
        }

    .input-group-sm input {
        border-radius: 4px !important;
        border: 1px solid #b8c8ff !important;
    }

    .btn-default {
        background: #dce6ff;
        border: 1px solid #b8c8ff;
        padding: 4px 8px;
    }

        .btn-default:hover {
            background: #cbd9ff;
        }

    .badge-warning {
        background-color: #f9c74f !important;
    }

    .badge-success {
        background-color: #4caf50 !important;
    }

    .badge-danger {
        background-color: #e63946 !important;
    }

    .badge-info {
        background-color: #219ebc !important;
    }
</style>


<div class="row">
    <div class="col-12">
        <div class="card">

            <div class="card-header">
                <a asp-action="Invite">
                    <button class="btn btn-primary">
                        <i class="fas fa-user-plus"></i> @Localizer["inviteNew"]
                    </button>
                </a>

                <div class="card-tools">
                    <div class="input-group input-group-sm" style="width: 160px;">
                        <input type="text" name="table_search" class="form-control float-right" placeholder="Search">

                        <div class="input-group-append">
                            <button type="submit" class="btn btn-default">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card-body table-responsive p-0">
                <table class="table table-hover text-nowrap">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>@Localizer["Name"]</th>
                            <th>@Localizer["guestEmail"]</th>
                            <th>@Localizer["guestPhoneNumber"]</th>
                            <th>@Localizer["Visit Start Date"]</th>
                            <th>@Localizer["Visit End Date"]</th>
                            <th>@Localizer["purposeOfVisit"]</th>
                            <th>@Localizer["responsiblePerson"]</th>
                            <th>@Localizer["approvalStatus"]</th>
                            <th>@Localizer["approver"]</th>
                            <th>@Localizer["Attachments"]</th>
                            <th></th>
                        </tr>
                    </thead>

                    <tbody>
                        @for (int i = 0; i < Model.Count; i++)
                        {
                            var invitation = Model[i];

                            <tr>
                                <td>@(i + 1)</td>

                                <td>
                                    @if (invitation.IsIndividual)
                                    {
                                        @(string.Join(" ", invitation.Guest?.FirstName, invitation.Guest?.LastName))
                                    }
                                    else
                                    {
                                        @invitation.Guest?.CompanyName
                                    }
                            </td>

                            <td>@invitation.Guest?.Email</td>
                            <td>@invitation.Guest?.Phone</td>

                            <td>
                                @(invitation.Status == "Pending" || invitation.Status == "Rejected"
                                                                ? invitation.VisitDateTimeStart.ToString("MM/dd/yyyy")
                                                                : invitation.ApprovedDateTimeStart)
                                                                                               </td>

                            <td>
                                @(invitation.Status == "Pending" || invitation.Status == "Rejected"
                                                                ? invitation.VisitDateTimeEnd.ToString("MM/dd/yyyy")
                                                                : invitation.ApprovedDateTimeEnd)
                            </td>

                                <td>@invitation.PurposeOfVisit</td>
                                <td>@(invitation.Employee?.FirstName + " " + invitation.Employee?.LastName)</td>

                                <td>
                                @if (invitation.Status == "Pending")
                                    {
                                        <span class="badge badge-warning">@Localizer["Pending"]</span>
                                    }
                                    @if (invitation.Status == "Approved")
                                    {
                                        <span class="badge badge-success">@Localizer["Approved"]</span>
                                    }
                                    @if (invitation.Status == "Reviewed")
                                    {
                                        <span class="badge badge-info">@Localizer["Reviewed"]</span>
                                    }
                                    @if (invitation.Status == "Rejected")
                                    {
                                        <span class="badge badge-danger">@Localizer["Rejected"]</span>
                                    }
                                </td>

                                <td>@(invitation.Approver?.Employee?.FirstName)</td>

                                <td>
                                    <a class="btn btn-primary btn-sm"
                                       asp-action="ApproveDisapprove"
                                       asp-route-id="@invitation.Id">
                                        <i class="fas fa-eye"></i> @Localizer["View Detail"]
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>

                </table>
            </div>

        </div>
    </div>
</div>

@section Scripts {
    <!-- Your scripts here -->
}
